<!DOCTYPE html>
<html>
<!-- Import necessary libraries from Google APIs, PyScript website -->
<head>
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>

<!-- Style adjustments -->
<style> 
    body {
    	font-family: 'Montserrat';
    	font-size: 20px;
    	text-align: center;
    	font-weight: bold;
  	}
    
    .container {
      text-align: center;
    }
    .btn {
    	display: inline-block;
    	font-size: 22px;
      padding: 0.5em 1em;
      border: none;
      text-align: center;
      background: white;
      left: 50%;
    }
    
    .btn:hover {
      color: white;
      transition: .5s ease-out;
    }

    .pca:hover {
      background: #18de50;
    }
    
    .tsne:hover {
      background: #223dd4;
    }
    .choose:hover {
      background: white;
      color: black;
    }
    
</style>
<body>

<!-- Only accept HDF5 file types -->
<label for="myH5File">
  Upload an H5 file here!
</label>
<input type="file" class="btn choose" accept=".h5" id="myH5File">
<br><br>
<div class="container">
  <h3> Please choose a dimensionality reduction method: </h3>
  <button id="pca button" class="btn pca">PCA</button>
  <button id="tsne button" class="btn tsne">T-SNE</button>
</div>
<!-- basically import packages-->
<py-config style="color: white;">
  packages = ["scikit-learn", "plotly", "pandas", "anndata", "disable_warnings", "requests"]
</py-config>
<py-script>
import os
import requests
import js 
import pyodide
import pandas as pd
import plotly.io as pio
import plotly.express as px
from sklearn.cluster import KMeans
from sklearn.manifold import TSNE
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA
import anndata as ad
from disable_warnings import *

async def get_file(e):
    files = e.target.files.to_py()
    for file in files:
      file_content = await file.text()
      print("Before anndata read")
      df = ad.read_h5ad(file_content)
      js.console.log(df)
get_file_proxy = pyodide.ffi.create_proxy(get_file)
js.document.getElementById("myH5File").addEventListener("change", get_file_proxy)
function_proxy = pyodide.ffi.create_proxy(processFile)
js.document.getElementById("pca button").addEventListener("click", function_proxy)
</py-script>
</html>
